# Publisher Tools 智能启动系统使用指南

## 📋 概述

本项目提供了一套完整的跨平台图形化启动脚本系统，让用户能够通过简单的双击操作启动所有服务，无需复杂的命令行操作。

## 🚀 快速开始

### 1. 环境验证（推荐第一步）
```bash
双击运行: verify-environment.bat
```
此脚本会检查您的开发环境是否满足要求：
- Node.js (版本 ≥ 18)
- Go (版本 ≥ 1.21)  
- npm 包管理器
- 项目依赖完整性

### 2. 启动所有服务
```bash
双击运行: start-enhanced.bat
```

### 3. 停止所有服务
```bash
双击运行: stop-enhanced.bat
```

## 📁 脚本文件说明

### 主要脚本文件

| 文件名 | 功能 | 使用场景 |
|--------|------|----------|
| `start-enhanced.bat` | 智能启动所有服务 | 日常开发启动 |
| `stop-enhanced.bat` | 安全停止所有服务 | 服务停止和清理 |
| `verify-environment.bat` | 环境依赖检查 | 首次使用前检查 |

### 自动生成的目录和文件

```
project-root/
├── logs/                    # 日志目录
│   ├── startup.log         # 启动过程日志
│   ├── server.log          # 后端服务日志
│   ├── web.log             # 前端服务日志
│   └── stop.log            # 停止过程日志
├── pids/                   # PID文件目录
│   ├── server.pid          # 后端服务PID
│   └── web.pid             # 前端服务PID
├── bin/                    # 编译输出目录
│   ├── publisher-server.exe # 后端服务可执行文件
│   └── publisher.exe        # CLI工具
├── cookies/                # Cookie存储目录
└── uploads/                # 文件上传目录
```

## 🔧 启动流程详解

### 启动脚本执行步骤

1. **目录初始化** (1/7)
   - 创建必要的目录结构
   - 清理旧的日志文件
   - 初始化日志系统

2. **环境依赖检查** (2/7)
   - 检查 Node.js 版本 (≥18)
   - 检查 Go 版本 (≥1.21)
   - 检查 npm 是否可用
   - 安装前端依赖（如需要）

3. **后端服务编译** (3/7)
   - 下载 Go 模块依赖
   - 编译后端服务可执行文件
   - 编译 CLI 工具

4. **后端服务启动** (4/7)
   - 终止可能存在的旧进程
   - 启动后端服务（端口 8080）
   - 记录进程 PID

5. **前端服务启动** (5/7)
   - 终止可能存在的旧进程
   - 启动前端开发服务器（端口 5173）
   - 记录进程 PID

6. **服务健康检测** (6/7)
   - 循环检测后端服务健康状态
   - 循环检测前端服务可用性
   - 最多重试 10 次，每次间隔 3 秒

7. **浏览器自动启动** (7/7)
   - 检测并优先使用夸克浏览器
   - 降级使用 Chrome、Edge 或默认浏览器
   - 自动打开应用主页

## 🛑 停止流程详解

### 停止脚本执行步骤

1. **服务状态检查** (1/4)
   - 显示当前运行的服务状态
   - 检查 PID 文件和进程状态
   - 显示端口占用情况

2. **服务进程停止** (2/4)
   - 根据 PID 文件终止进程
   - 通过窗口标题匹配终止进程
   - 删除 PID 文件

3. **残留进程清理** (3/4)
   - 根据端口占用情况强制终止进程
   - 清理相关的 node.exe 和 go.exe 进程

4. **临时文件清理** (4/4)
   - 清理 PID 文件
   - 可选清理日志文件
   - 最终状态验证

## 🌐 浏览器启动策略

脚本会按以下优先级启动浏览器：

1. **夸克浏览器** - `%LOCALAPPDATA%\Google\Chrome\Application\chrome.exe`
2. **Chrome 浏览器** - `C:\Program Files\Google\Chrome\Application\chrome.exe`
3. **Edge 浏览器** - `C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe`
4. **系统默认浏览器** - 使用系统关联的默认浏览器

## 📊 服务访问地址

启动成功后，可以通过以下地址访问服务：

- **前端界面**: http://localhost:5173
- **后端API**: http://localhost:8080/api/v1
- **健康检查**: http://localhost:8080/api/v1/health

## 🛠️ 故障排除

### 常见问题及解决方案

#### 1. 环境依赖缺失
```
错误信息: 环境依赖缺失 - 请安装所需的开发环境后再试
解决方案: 
- 安装 Node.js (版本 ≥ 18) - https://nodejs.org
- 安装 Go (版本 ≥ 1.21) - https://golang.org  
- 确保 npm 命令可用
- 运行 verify-environment.bat 验证环境
```

#### 2. 端口被占用
```
错误信息: 后端启动失败 - 无法启动后端服务，请检查端口占用情况
解决方案:
- 运行 stop-enhanced.bat 停止现有服务
- 检查是否有其他程序占用 8080 或 5173 端口
- 重启计算机后重试
- 使用 netstat -ano | findstr ":8080" 查看占用进程
```

#### 3. 编译失败
```
错误信息: 编译失败 - 后端服务编译过程中出现错误
解决方案:
- 检查 Go 环境配置
- 确保网络连接正常（需要下载模块依赖）
- 查看 logs/startup.log 获取详细错误信息
- 尝试手动运行: cd publisher-core && go mod download
```

#### 4. 服务启动超时
```
错误信息: 服务启动超时 - 服务未能在预期时间内就绪
解决方案:
- 检查防火墙设置是否阻止了服务
- 查看具体服务日志文件
- 确认系统资源充足（内存、CPU）
- 尝试单独启动服务进行调试
```

#### 5. 浏览器无法启动
```
错误信息: 浏览器启动失败
解决方案:
- 检查浏览器是否正确安装
- 确认浏览器路径是否正确
- 尝试手动在浏览器中访问 http://localhost:5173
- 检查系统默认浏览器设置
```

### 日志文件位置

- **启动日志**: `logs/startup.log` - 启动过程的详细信息
- **后端日志**: `logs/server.log` - 后端服务运行日志
- **前端日志**: `logs/web.log` - 前端服务运行日志
- **停止日志**: `logs/stop.log` - 服务停止过程日志

### 关键日志关键词

在日志文件中搜索以下关键词可以帮助定位问题：

- `"ERROR"` - 错误信息
- `"FAILED"` - 失败操作
- `"timeout"` - 超时问题
- `"connection refused"` - 连接拒绝
- `"port already in use"` - 端口占用

## ⚙️ 高级配置

### 自定义端口

如果需要修改默认端口，可以编辑启动脚本中的配置部分：

```batch
set "SERVER_PORT=8080"    # 修改后端端口
set "WEB_PORT=5173"       # 修改前端端口
```

### 浏览器路径自定义

可以在 `:open_browser` 函数中添加自定义浏览器路径：

```batch
:: 添加自定义浏览器路径
set "CUSTOM_BROWSER=C:\Path\To\Your\Browser.exe"
if exist "%CUSTOM_BROWSER%" (
    start "" "%CUSTOM_BROWSER%" "http://localhost:%WEB_PORT%"
    echo     [✓] 使用自定义浏览器打开
    exit /b 0
)
```

## 🎯 最佳实践

### 开发环境建议

1. **首次使用**
   - 运行 `verify-environment.bat` 检查环境
   - 确保网络连接良好（需要下载依赖）
   - 首次启动可能需要较长时间（安装依赖和编译）

2. **日常使用**
   - 直接双击 `start-enhanced.bat` 启动服务
   - 使用 `stop-enhanced.bat` 停止服务
   - 定期查看日志文件了解服务状态

3. **问题排查**
   - 查看对应的日志文件获取详细信息
   - 使用 `stop-enhanced.bat` 彻底清理环境
   - 重新启动服务验证问题是否解决

### 生产环境考虑

对于生产环境部署，建议：

1. 使用 Docker 容器化部署
2. 配置反向代理（Nginx/Apache）
3. 设置 SSL 证书
4. 配置系统服务自动启动
5. 实施监控和告警机制

## 🔒 安全注意事项

1. **进程管理**
   - 脚本只会终止与项目相关的进程
   - 使用窗口标题和PID文件进行精确识别
   - 避免误杀系统关键进程

2. **端口安全**
   - 默认只绑定本地回环地址 (127.0.0.1)
   - 建议生产环境配置防火墙规则
   - 不要在公网直接暴露开发服务

3. **文件权限**
   - 日志文件和PID文件存储在项目目录下
   - 确保项目目录有适当的读写权限
   - 定期清理旧的日志文件

## 🆘 技术支持

如遇到无法解决的问题，请：

1. 运行 `verify-environment.bat` 获取环境信息
2. 查看相关日志文件的完整错误信息
3. 记录复现步骤和错误详情
4. 在项目 Issues 中提交问题报告

---

**版本**: v2.0  
**最后更新**: 2026-02-19  
**维护者**: MonkeyCode Team